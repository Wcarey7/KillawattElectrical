{% extends 'base.html.j2' %}
{% from "macros.html.j2" import render_pagination %}


{% block content %}

<div class="container text-center mb-5 mt-5">
    <span class="title"><h1>{% block title %} The Customer Page {% endblock %}</h1></span>
</div>


{# New Customer Button #}
<div class="col-md-4 mb-3">
    <a href="{{ url_for('customer.add_customer')}}">
        <button type="button" class="btn btn-primary">New Customer</button>
    </a>
</div>


{# Search Bar and Button #}
<form action="{{ url_for('customer.search', search_tag='search_tag') }}" method="POST" class="row mb-3" novalidate>
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <div class="col-sm-4 mb-3">
    <div class="input-group">
      <input type="text" class="form-control" name="search_tag" id="search_tag" placeholder="Search By Name">
    </div>
  </div>

  <div class="col-sm-2 mb-3">
    <button type="submit" class="btn btn-primary">Search</button>
  </div>
</form>


{# Customer Results Table #}
<div class="content">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr class="text-center">
                <th>ID</th>
                <th>Name</th>
                <th>Street</th>
                <th>City</th>
                <th>State</th>
                <th>Zip</th>
                <th>View</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="customers">
            {% for customer in customers.items %}
                <tr class="text-center">
                    <td>{{ customer.id }}</td>
                    <td>{{ customer.name }}</td>
                    <td>{{ customer.addresses[0].street }}</td>
                    <td>{{ customer.addresses[0].city }}</td>
                    <td>{{ customer.addresses[0].state }}</td>
                    <td>{{ customer.addresses[0].zip }}</td>
                    <td><a href="{{ url_for('customer.detail', Id=customer.id)}}"><button type="button" class="btn btn-primary">View</button></a></td>
                    <td><form method="POST" action="{{ url_for('customer.delete_customer', Id=customer.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <input type="submit" value="Delete" onclick="return confirm('Are you sure you want to delete this customer?')"></form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


{# PAGINATION MACRO #}
<ul class="pagination justify-content-center">
    {# Endpoint passed in from route. Either, 'customer.index' or 'customer.search'. #}
    {{ render_pagination(customers, endpoint )}}
</ul>


{% endblock %}
